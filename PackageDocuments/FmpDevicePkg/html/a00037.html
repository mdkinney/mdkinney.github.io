<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3"/>
<title>FmpDevicePkg[all]: edk2/FmpDevicePkg/Include/Library/FmpDeviceLib.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">FmpDevicePkg[all]
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('a00037.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">FmpDeviceLib.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ad612fc61815de278e6a12f9c24e738d3"><td class="memItemLeft" align="right" valign="top">typedef EFI_STATUS(EFIAPI *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00037.html#ad612fc61815de278e6a12f9c24e738d3">FMP_DEVICE_LIB_REGISTER_FMP_INSTALLER</a> )(IN EFI_HANDLE Handle)</td></tr>
<tr class="separator:ad612fc61815de278e6a12f9c24e738d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5f31bd9afcce5c40b11a8056e145aa74"><td class="memItemLeft" align="right" valign="top">EFI_STATUS EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00037.html#a5f31bd9afcce5c40b11a8056e145aa74">RegisterFmpInstaller</a> (IN <a class="el" href="a00037.html#ad612fc61815de278e6a12f9c24e738d3">FMP_DEVICE_LIB_REGISTER_FMP_INSTALLER</a> FmpInstaller)</td></tr>
<tr class="separator:a5f31bd9afcce5c40b11a8056e145aa74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13fa1563f10844e985d9538b3c3bac87"><td class="memItemLeft" align="right" valign="top">EFI_STATUS EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00037.html#a13fa1563f10844e985d9538b3c3bac87">FmpDeviceGetSize</a> (OUT UINTN *Size)</td></tr>
<tr class="separator:a13fa1563f10844e985d9538b3c3bac87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab579c477c03e529245be72aad784cb4b"><td class="memItemLeft" align="right" valign="top">EFI_STATUS EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00037.html#ab579c477c03e529245be72aad784cb4b">FmpDeviceGetImageTypeIdGuidPtr</a> (OUT EFI_GUID **Guid)</td></tr>
<tr class="separator:ab579c477c03e529245be72aad784cb4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a532053136f8fcd24f495c3414d7ff9e4"><td class="memItemLeft" align="right" valign="top">EFI_STATUS EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00037.html#a532053136f8fcd24f495c3414d7ff9e4">FmpDeviceGetAttributes</a> (OUT UINT64 *Supported, OUT UINT64 *Setting)</td></tr>
<tr class="separator:a532053136f8fcd24f495c3414d7ff9e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ce5e5ba5c02764ffdd23887cfa78851"><td class="memItemLeft" align="right" valign="top">EFI_STATUS EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00037.html#a8ce5e5ba5c02764ffdd23887cfa78851">FmpDeviceGetLowestSupportedVersion</a> (OUT UINT32 *LowestSupportedVersion)</td></tr>
<tr class="separator:a8ce5e5ba5c02764ffdd23887cfa78851"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98db5c9d2b7a0416b8c576ba32c4a1eb"><td class="memItemLeft" align="right" valign="top">EFI_STATUS EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00037.html#a98db5c9d2b7a0416b8c576ba32c4a1eb">FmpDeviceGetVersionString</a> (OUT CHAR16 **VersionString)</td></tr>
<tr class="separator:a98db5c9d2b7a0416b8c576ba32c4a1eb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44a7b3bc7cf5ae628bc56b75525d2602"><td class="memItemLeft" align="right" valign="top">EFI_STATUS EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00037.html#a44a7b3bc7cf5ae628bc56b75525d2602">FmpDeviceGetVersion</a> (OUT UINT32 *Version)</td></tr>
<tr class="separator:a44a7b3bc7cf5ae628bc56b75525d2602"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02ba7d9cea7cda4244155f3a6eec8cf2"><td class="memItemLeft" align="right" valign="top">EFI_STATUS EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00037.html#a02ba7d9cea7cda4244155f3a6eec8cf2">FmpDeviceGetImage</a> (OUT VOID *Image, IN OUT UINTN *ImageSize)</td></tr>
<tr class="separator:a02ba7d9cea7cda4244155f3a6eec8cf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25002042eb08c4e680c752e4c5b8eab5"><td class="memItemLeft" align="right" valign="top">EFI_STATUS EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00037.html#a25002042eb08c4e680c752e4c5b8eab5">FmpDeviceCheckImage</a> (IN CONST VOID *Image, IN UINTN ImageSize, OUT UINT32 *ImageUpdatable)</td></tr>
<tr class="separator:a25002042eb08c4e680c752e4c5b8eab5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38a07600dd675ddac16d58ba5c95c74d"><td class="memItemLeft" align="right" valign="top">EFI_STATUS EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00037.html#a38a07600dd675ddac16d58ba5c95c74d">FmpDeviceSetImage</a> (IN CONST VOID *Image, IN UINTN ImageSize, IN CONST VOID *VendorCode, IN EFI_FIRMWARE_MANAGEMENT_UPDATE_IMAGE_PROGRESS Progress, IN UINT32 CapsuleFwVersion, OUT CHAR16 **AbortReason)</td></tr>
<tr class="separator:a38a07600dd675ddac16d58ba5c95c74d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3818f07ea7874ccfbc3215e7b4567753"><td class="memItemLeft" align="right" valign="top">EFI_STATUS EFIAPI&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00037.html#a3818f07ea7874ccfbc3215e7b4567753">FmpDeviceLock</a> (VOID)</td></tr>
<tr class="separator:a3818f07ea7874ccfbc3215e7b4567753"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Provides firmware device specific services to support updates of a firmware image stored in a firmware device.</p>
<p>Copyright (c) 2016, Microsoft Corporation. All rights reserved.<br/>
 Copyright (c) 2018, Intel Corporation. All rights reserved.<br/>
</p>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
<ol type="1">
<li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
<li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
</ol>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ad612fc61815de278e6a12f9c24e738d3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef EFI_STATUS(EFIAPI * FMP_DEVICE_LIB_REGISTER_FMP_INSTALLER)(IN EFI_HANDLE Handle)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback function that installs a Firmware Management Protocol instance onto a handle.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Handle</td><td>The device handle to install a Firmware Management Protocol instance.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>A Firmware Management Protocol instance was installed onto Handle. </td></tr>
    <tr><td class="paramname">EFI_INVALID_PARAMETER</td><td>Handle is invalid </td></tr>
    <tr><td class="paramname">other</td><td>A Firmware Management Protocol instance could not be installed onto Handle. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a25002042eb08c4e680c752e4c5b8eab5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EFI_STATUS EFIAPI FmpDeviceCheckImage </td>
          <td>(</td>
          <td class="paramtype">IN CONST VOID *&#160;</td>
          <td class="paramname"><em>Image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINTN&#160;</td>
          <td class="paramname"><em>ImageSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT UINT32 *&#160;</td>
          <td class="paramname"><em>ImageUpdatable</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Checks if a new firmware image is valid for the firmware device. This function allows firmware update operation to validate the firmware image before <a class="el" href="a00037.html#a38a07600dd675ddac16d58ba5c95c74d">FmpDeviceSetImage()</a> is called.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Image</td><td>Points to a new firmware image. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ImageSize</td><td>Size, in bytes, of a new firmware image. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ImageUpdatable</td><td>Indicates if a new firmware image is valid for a firmware update to the firmware device. The following values from the Firmware Management Protocol are supported: IMAGE_UPDATABLE_VALID IMAGE_UPDATABLE_INVALID IMAGE_UPDATABLE_INVALID_TYPE IMAGE_UPDATABLE_INVALID_OLD IMAGE_UPDATABLE_VALID_WITH_VENDOR_CODE</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>The image was successfully checked. Additional status information is returned in ImageUpdatable. </td></tr>
    <tr><td class="paramname">EFI_INVALID_PARAMETER</td><td>Image is NULL. </td></tr>
    <tr><td class="paramname">EFI_INVALID_PARAMETER</td><td>ImageUpdatable is NULL. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a532053136f8fcd24f495c3414d7ff9e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EFI_STATUS EFIAPI FmpDeviceGetAttributes </td>
          <td>(</td>
          <td class="paramtype">OUT UINT64 *&#160;</td>
          <td class="paramname"><em>Supported</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT UINT64 *&#160;</td>
          <td class="paramname"><em>Setting</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns values used to fill in the AttributesSupported and AttributesSettings fields of the EFI_FIRMWARE_IMAGE_DESCRIPTOR structure that is returned by the GetImageInfo() service of the Firmware Management Protocol. The following bit values from the Firmware Management Protocol may be combined: IMAGE_ATTRIBUTE_IMAGE_UPDATABLE IMAGE_ATTRIBUTE_RESET_REQUIRED IMAGE_ATTRIBUTE_AUTHENTICATION_REQUIRED IMAGE_ATTRIBUTE_IN_USE IMAGE_ATTRIBUTE_UEFI_IMAGE</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">Supported</td><td>Attributes supported by this firmware device. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Setting</td><td>Attributes settings for this firmware device.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>The attributes supported by the firmware device were returned. </td></tr>
    <tr><td class="paramname">EFI_INVALID_PARAMETER</td><td>Supported is NULL. </td></tr>
    <tr><td class="paramname">EFI_INVALID_PARAMETER</td><td>Setting is NULL. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a02ba7d9cea7cda4244155f3a6eec8cf2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EFI_STATUS EFIAPI FmpDeviceGetImage </td>
          <td>(</td>
          <td class="paramtype">OUT VOID *&#160;</td>
          <td class="paramname"><em>Image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN OUT UINTN *&#160;</td>
          <td class="paramname"><em>ImageSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns a copy of the firmware image currently stored in the firmware device.</p>
<dl class="section note"><dt>Note</dt><dd>It is recommended that all firmware devices support a method to retrieve a copy currently stored firmware image. This can be used to support features such as recovery and rollback.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">Image</td><td>Pointer to a caller allocated buffer where the currently stored firmware image is copied to. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ImageSize</td><td>Pointer the size, in bytes, of the Image buffer. On return, points to the size, in bytes, of firmware image currently stored in the firmware device.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>Image contains a copy of the firmware image currently stored in the firmware device, and ImageSize contains the size, in bytes, of the firmware image currently stored in the firmware device. </td></tr>
    <tr><td class="paramname">EFI_BUFFER_TOO_SMALL</td><td>The buffer specified by ImageSize is too small to hold the firmware image currently stored in the firmware device. The buffer size required is returned in ImageSize. </td></tr>
    <tr><td class="paramname">EFI_INVALID_PARAMETER</td><td>The Image is NULL. </td></tr>
    <tr><td class="paramname">EFI_INVALID_PARAMETER</td><td>The ImageSize is NULL. </td></tr>
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>The operation is not supported. </td></tr>
    <tr><td class="paramname">EFI_DEVICE_ERROR</td><td>An error occurred attempting to retrieve the firmware image currently stored in the firmware device. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ab579c477c03e529245be72aad784cb4b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EFI_STATUS EFIAPI FmpDeviceGetImageTypeIdGuidPtr </td>
          <td>(</td>
          <td class="paramtype">OUT EFI_GUID **&#160;</td>
          <td class="paramname"><em>Guid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the GUID value used to fill in the ImageTypeId field of the EFI_FIRMWARE_IMAGE_DESCRIPTOR structure that is returned by the GetImageInfo() service of the Firmware Management Protocol. If EFI_UNSUPPORTED is returned, then the ImageTypeId field is set to gEfiCallerIdGuid. If EFI_SUCCESS is returned, then ImageTypeId is set to the Guid returned from this function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">Guid</td><td>Double pointer to a GUID value that is updated to point to to a GUID value. The GUID value is not allocated and must not be modified or freed by the caller.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>EFI_FIRMWARE_IMAGE_DESCRIPTOR ImageTypeId GUID is set to the returned Guid value. </td></tr>
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>EFI_FIRMWARE_IMAGE_DESCRIPTOR ImageTypeId GUID is set to gEfiCallerIdGuid. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a8ce5e5ba5c02764ffdd23887cfa78851"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EFI_STATUS EFIAPI FmpDeviceGetLowestSupportedVersion </td>
          <td>(</td>
          <td class="paramtype">OUT UINT32 *&#160;</td>
          <td class="paramname"><em>LowestSupportedVersion</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the value used to fill in the LowestSupportedVersion field of the EFI_FIRMWARE_IMAGE_DESCRIPTOR structure that is returned by the GetImageInfo() service of the Firmware Management Protocol. If EFI_SUCCESS is returned, then the firmware device supports a method to report the LowestSupportedVersion value from the currently stored firmware image. If the value can not be reported for the firmware image currently stored in the firmware device, then EFI_UNSUPPORTED must be returned. EFI_DEVICE_ERROR is returned if an error occurs attempting to retrieve the LowestSupportedVersion value for the currently stored firmware image.</p>
<dl class="section note"><dt>Note</dt><dd>It is recommended that all firmware devices support a method to report the LowestSupportedVersion value from the currently stored firmware image.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">LowestSupportedVersion</td><td>LowestSupportedVersion value retrieved from the currently stored firmware image.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>The lowest supported version of currently stored firmware image was returned in LowestSupportedVersion. </td></tr>
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>The firmware device does not support a method to report the lowest supported version of the currently stored firmware image. </td></tr>
    <tr><td class="paramname">EFI_DEVICE_ERROR</td><td>An error occurred attempting to retrieve the lowest supported version of the currently stored firmware image. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a13fa1563f10844e985d9538b3c3bac87"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EFI_STATUS EFIAPI FmpDeviceGetSize </td>
          <td>(</td>
          <td class="paramtype">OUT UINTN *&#160;</td>
          <td class="paramname"><em>Size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the size, in bytes, of the firmware image currently stored in the firmware device. This function is used to by the GetImage() and GetImageInfo() services of the Firmware Management Protocol. If the image size can not be determined from the firmware device, then 0 must be returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">Size</td><td>Pointer to the size, in bytes, of the firmware image currently stored in the firmware device.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>The size of the firmware image currently stored in the firmware device was returned. </td></tr>
    <tr><td class="paramname">EFI_INVALID_PARAMETER</td><td>Size is NULL. </td></tr>
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>The firmware device does not support reporting the size of the currently stored firmware image. </td></tr>
    <tr><td class="paramname">EFI_DEVICE_ERROR</td><td>An error occured attempting to determine the size of the firmware image currently stored in in the firmware device. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a44a7b3bc7cf5ae628bc56b75525d2602"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EFI_STATUS EFIAPI FmpDeviceGetVersion </td>
          <td>(</td>
          <td class="paramtype">OUT UINT32 *&#160;</td>
          <td class="paramname"><em>Version</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the value used to fill in the Version field of the EFI_FIRMWARE_IMAGE_DESCRIPTOR structure that is returned by the GetImageInfo() service of the Firmware Management Protocol. If EFI_SUCCESS is returned, then the firmware device supports a method to report the Version value from the currently stored firmware image. If the value can not be reported for the firmware image currently stored in the firmware device, then EFI_UNSUPPORTED must be returned. EFI_DEVICE_ERROR is returned if an error occurs attempting to retrieve the LowestSupportedVersion value for the currently stored firmware image.</p>
<dl class="section note"><dt>Note</dt><dd>It is recommended that all firmware devices support a method to report the Version value from the currently stored firmware image.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">Version</td><td>The version value retrieved from the currently stored firmware image.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>The version of currently stored firmware image was returned in Version. </td></tr>
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>The firmware device does not support a method to report the version of the currently stored firmware image. </td></tr>
    <tr><td class="paramname">EFI_DEVICE_ERROR</td><td>An error occurred attempting to retrieve the version of the currently stored firmware image. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a98db5c9d2b7a0416b8c576ba32c4a1eb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EFI_STATUS EFIAPI FmpDeviceGetVersionString </td>
          <td>(</td>
          <td class="paramtype">OUT CHAR16 **&#160;</td>
          <td class="paramname"><em>VersionString</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Returns the Null-terminated Unicode string that is used to fill in the VersionName field of the EFI_FIRMWARE_IMAGE_DESCRIPTOR structure that is returned by the GetImageInfo() service of the Firmware Management Protocol. The returned string must be allocated using EFI_BOOT_SERVICES.AllocatePool().</p>
<dl class="section note"><dt>Note</dt><dd>It is recommended that all firmware devices support a method to report the VersionName string from the currently stored firmware image.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">VersionString</td><td>The version string retrieved from the currently stored firmware image.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>The version string of currently stored firmware image was returned in Version. </td></tr>
    <tr><td class="paramname">EFI_INVALID_PARAMETER</td><td>VersionString is NULL. </td></tr>
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>The firmware device does not support a method to report the version string of the currently stored firmware image. </td></tr>
    <tr><td class="paramname">EFI_DEVICE_ERROR</td><td>An error occurred attempting to retrieve the version string of the currently stored firmware image. </td></tr>
    <tr><td class="paramname">EFI_OUT_OF_RESOURCES</td><td>There are not enough resources to allocate the buffer for the version string of the currently stored firmware image. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a3818f07ea7874ccfbc3215e7b4567753"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EFI_STATUS EFIAPI FmpDeviceLock </td>
          <td>(</td>
          <td class="paramtype">VOID&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Lock the firmware device that contains a firmware image. Once a firmware device is locked, any attempts to modify the firmware image contents in the firmware device must fail.</p>
<dl class="section note"><dt>Note</dt><dd>It is recommended that all firmware devices support a lock method to prevent modifications to a stored firmware image.</dd>
<dd>
A firmware device lock mechanism is typically only cleared by a full system reset (not just sleep state/low power mode).</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>The firmware device was locked. </td></tr>
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>The firmware device does not support locking </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a38a07600dd675ddac16d58ba5c95c74d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EFI_STATUS EFIAPI FmpDeviceSetImage </td>
          <td>(</td>
          <td class="paramtype">IN CONST VOID *&#160;</td>
          <td class="paramname"><em>Image</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINTN&#160;</td>
          <td class="paramname"><em>ImageSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN CONST VOID *&#160;</td>
          <td class="paramname"><em>VendorCode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN EFI_FIRMWARE_MANAGEMENT_UPDATE_IMAGE_PROGRESS&#160;</td>
          <td class="paramname"><em>Progress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">IN UINT32&#160;</td>
          <td class="paramname"><em>CapsuleFwVersion</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">OUT CHAR16 **&#160;</td>
          <td class="paramname"><em>AbortReason</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Updates a firmware device with a new firmware image. This function returns EFI_UNSUPPORTED if the firmware image is not updatable. If the firmware image is updatable, the function should perform the following minimal validations before proceeding to do the firmware image update.</p>
<ul>
<li>Validate that the image is a supported image for this firmware device. Return EFI_ABORTED if the image is not supported. Additional details on why the image is not a supported image may be returned in AbortReason.</li>
<li>Validate the data from VendorCode if is not NULL. Firmware image validation must be performed before VendorCode data validation. VendorCode data is ignored or considered invalid if image validation fails. Return EFI_ABORTED if the VendorCode data is invalid.</li>
</ul>
<p>VendorCode enables vendor to implement vendor-specific firmware image update policy. Null if the caller did not specify the policy or use the default policy. As an example, vendor can implement a policy to allow an option to force a firmware image update when the abort reason is due to the new firmware image version is older than the current firmware image version or bad image checksum. Sensitive operations such as those wiping the entire firmware image and render the device to be non-functional should be encoded in the image itself rather than passed with the VendorCode. AbortReason enables vendor to have the option to provide a more detailed description of the abort reason to the caller.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">Image</td><td>Points to the new firmware image. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ImageSize</td><td>Size, in bytes, of the new firmware image. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">VendorCode</td><td>This enables vendor to implement vendor-specific firmware image update policy. NULL indicates the caller did not specify the policy or use the default policy. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">Progress</td><td>A function used to report the progress of updating the firmware device with the new firmware image. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">CapsuleFwVersion</td><td>The version of the new firmware image from the update capsule that provided the new firmware image. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">AbortReason</td><td>A pointer to a pointer to a Null-terminated Unicode string providing more details on an aborted operation. The buffer is allocated by this function with EFI_BOOT_SERVICES.AllocatePool(). It is the caller's responsibility to free this buffer with EFI_BOOT_SERVICES.FreePool().</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>The firmware device was successfully updated with the new firmware image. </td></tr>
    <tr><td class="paramname">EFI_ABORTED</td><td>The operation is aborted. Additional details are provided in AbortReason. </td></tr>
    <tr><td class="paramname">EFI_INVALID_PARAMETER</td><td>The Image was NULL. </td></tr>
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>The operation is not supported. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a5f31bd9afcce5c40b11a8056e145aa74"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EFI_STATUS EFIAPI RegisterFmpInstaller </td>
          <td>(</td>
          <td class="paramtype">IN <a class="el" href="a00037.html#ad612fc61815de278e6a12f9c24e738d3">FMP_DEVICE_LIB_REGISTER_FMP_INSTALLER</a>&#160;</td>
          <td class="paramname"><em>FmpInstaller</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Provide a function to install the Firmware Management Protocol instance onto a device handle when the device is managed by a driver that follows the UEFI Driver Model. If the device is not managed by a driver that follows the UEFI Driver Model, then EFI_UNSUPPORTED is returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">FmpInstaller</td><td>Function that installs the Firmware Management Protocol.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">EFI_SUCCESS</td><td>The device is managed by a driver that follows the UEFI Driver Model. FmpInstaller must be called on each Driver Binding Start(). </td></tr>
    <tr><td class="paramname">EFI_UNSUPPORTED</td><td>The device is not managed by a driver that follows the UEFI Driver Model. </td></tr>
    <tr><td class="paramname">other</td><td>The Firmware Management Protocol for this firmware device is not installed. The firmware device is still locked using <a class="el" href="a00037.html#a3818f07ea7874ccfbc3215e7b4567753">FmpDeviceLock()</a>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_812a0318d84418780f07435dc949cc87.html">edk2</a></li><li class="navelem"><a class="el" href="dir_a3def6e68022bb2ff4a219eba0a43d6f.html">FmpDevicePkg</a></li><li class="navelem"><a class="el" href="dir_eb3776002f4e55430e411e1c23ddbdba.html">Include</a></li><li class="navelem"><a class="el" href="dir_8c03f0f7b53d553a8d4d20e393bd4a39.html">Library</a></li><li class="navelem"><a class="el" href="a00037.html">FmpDeviceLib.h</a></li>
    <li class="footer">Generated on Wed Aug 15 2018 16:30:50 for FmpDevicePkg[all] by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3 </li>
  </ul>
</div>
</body>
</html>
